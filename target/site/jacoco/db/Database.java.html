<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Database.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JavaCalendar</a> &gt; <a href="index.source.html" class="el_package">db</a> &gt; <span class="el_source">Database.java</span></div><h1>Database.java</h1><pre class="source lang-java linenums">package db;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.util.NoSuchElementException;
import java.util.Scanner;
import javax.swing.JOptionPane;

import appointments.Appointment;
import appointments.AppointmentNode;

import calendars.Calendar;
import calendars.CalendarTree;
import calendars.CalendarTreeNode;

/******************************************************************************/
/* Guilherme Virgilio P. O. Simoes                                            */
/* Login ID: pici7127                                                         */
/* CS-102, Winter 2016                                                        */
/* Programming Assignment 5                                                   */
/* Appointment calendar: collection of methods that manage the appointment    */
/* objects. Collection of Calendar objects that store appointment instances   */
/******************************************************************************/

/**
 * 
 * @author Guilherme Virgilio P. O. Simoes 
 * @version 1.1.0
 * 
 * Transformation of CS-102 project into a Maven project
 */
<span class="nc" id="L35">public class Database {</span>

Gui thisGUI; //interface assigned to this database

    // Make list of calendar objects that compose the database
<span class="nc" id="L40">    public CalendarTree calendarSet = new CalendarTree();</span>

/******************************************************************************/
/* Method: assignGUI                                                          */
/* Purpose: copies a reference to a database and returns it so that it can be */
/*          re-assigned to the GUI and seen from this class.                  */
/*                                                                            */          
/* Parameters:                                                                */
/*  Database copying: reference to the database being copied to the GUI       */     
/* Returns: void                                                              */
/******************************************************************************/    
    public void assignGUI (Gui copying){
<span class="nc" id="L52">        thisGUI = copying;</span>
<span class="nc" id="L53">    }</span>
    
/******************************************************************************/
/* Method: isEmpty                                                            */
/* Purpose: tells if the list is empty (i.e.) if its number of elements is    */
/*          zero                                                              */
/* Parameters:                                                                */
/*  void                                                                      */
/* Returns: Boolean:    is the list empty?                                    */
/******************************************************************************/
    
    public boolean isEmpty(){
<span class="nc" id="L65">        return calendarSet.isEmpty();</span>
    }

/******************************************************************************/
/* Method: size                                                               */
/* Purpose: loops through the list and counts the number of elements          */
/*                                                                            */
/* Parameters:                                                                */
/*  void                                                                      */
/* Returns: int:        number of elements in the list                        */
/******************************************************************************/    
    
    public int size(){
<span class="nc" id="L78">        return calendarSet.size();</span>
    }

/******************************************************************************/
/* Method: add                                                                */
/* Purpose: adds a calendar instance to the list at the necessary             */
/*          position so that it remains in sorted order                       */
/* Parameters:                                                                */
/*  Calendar item: item that needs to be included in the list                 */
/* Returns: void                                                              */
/******************************************************************************/ 
    
    void add(Calendar item){     
<span class="nc" id="L91">        calendarSet.add(item);               </span>
<span class="nc" id="L92">    }</span>

/******************************************************************************/
/* Method: addToCalendar                                                      */
/* Purpose: adds an appointment instance to an existing calendar in the list  */
/*                                                                            */
/* Parameters:                                                                */
/*  CalendarNode calendar:         the calendar object                        */
/*  String date:                   date of the appointment                    */    
/*  String startTIme:              start time of the appointment              */
/*  String endTime:                end time of the appointment                */
/*  String description:            given description to the appointment       */
/*  Gui    userGUI:                interface to be printed on                 */    
/* Returns: boolean:               Created and attached appointment?          */
/******************************************************************************/
    
    boolean addToCalendar (Calendar calendar, String date, String startTime, 
                           String endTime, String description){
<span class="nc" id="L110">        Appointment temp = new Appointment(); </span>
        //create temporary appointment 
<span class="nc" id="L112">        boolean legit = false; //are appointment parameters legal?</span>
<span class="nc" id="L113">            temp.changeCalendarName(calendar.getCalendarName()); </span>
            //set name
<span class="nc" id="L115">            legit = temp.setDate(date);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">            if (legit == true)     //means it is a valid date</span>
<span class="nc" id="L117">                legit = temp.setTime(startTime, endTime);</span>
<span class="nc" id="L118">            temp.setDescription(description);</span>
<span class="nc" id="L119">            temp.setGUI(thisGUI);</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">            if (legit == true) {</span>
<span class="nc" id="L121">                calendar.add(temp);</span>
<span class="nc" id="L122">                return true;</span>
            }
            else{
<span class="nc" id="L125">                thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;**** &quot; + calendar.getCalendarName()</span>
<span class="nc" id="L126">                    + &quot;'s \n&quot; +  &quot;**** '&quot; + temp.getDescription() </span>
<span class="nc" id="L127">                    + &quot;' not included!\n&quot;);</span>
<span class="nc" id="L128">                thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
<span class="nc" id="L129">                return false;</span>
            }
    }
    
/******************************************************************************/
/* Method: deleteFromCalendar                                                 */
/* Purpose: deletes an appointment that exists in the provided list           */
/*                                                                            */
/* Parameters:                                                                */
/*  CalendarNode calendar:         the calendar object                        */
/*  String date:                   date of the appointment                    */    
/*  String startTIme:              start time of the appointment              */
/*  String endTime:                end time of the appointment                */
/*  String description:            given description to the appointment       */   
/* Returns: boolean:               Created and attached appointment?          */
/******************************************************************************/
    
    boolean deleteFromCalendar (Calendar calendar, String date, String startTime 
                           ,String endTime, String descr){
        //Loop throught the list to find the desired appointment
<span class="nc bnc" id="L149" title="All 2 branches missed.">        for(int index = 0 ; index &lt; calendar.size(); index++){</span>
<span class="nc" id="L150">            String answer = &quot;&quot;; //stores user answer</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">            if(calendar.get(index).getDate().equals(date))</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">               if(calendar.get(index).getStartTime().equals(startTime))</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                   if(calendar.get(index).getEndTime().equals(endTime))</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">                       if(calendar.get(index).getDescription().contains(descr)){</span>
<span class="nc" id="L155">                          calendar.get(index).print();</span>
                            //keep prompting user until they answer correctly
<span class="nc bnc" id="L157" title="All 2 branches missed.">                            while(answer.compareTo(&quot;Y&quot;) != 0 &amp;&amp; </span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">                                answer.compareTo(&quot;N&quot;) != 0 &amp;&amp; </span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                                answer.compareTo(&quot;y&quot;) != 0 &amp;&amp; </span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                                answer.compareTo(&quot;n&quot;) != 0){</span>
<span class="nc" id="L161">                            answer = JOptionPane.showInputDialog(</span>
<span class="nc" id="L162">                                    &quot;Are you sure you want to delete&quot;</span>
                                  + &quot; the appointment above? Y = yes, N = no&quot;);                            
                          }
<span class="nc bnc" id="L165" title="All 2 branches missed.">                          if(answer.toLowerCase().compareTo(&quot;n&quot;) == 0)</span>
<span class="nc" id="L166">                              return false;</span>
<span class="nc" id="L167">                          calendar.remove(index);</span>
<span class="nc" id="L168">                          return true;</span>
                       }         
        }
<span class="nc" id="L171">        thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;None of the appointments match the &quot;</span>
                + &quot;description.&quot;);
<span class="nc" id="L173">        thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
<span class="nc" id="L174">        return false;</span>
    }   
   
    
/******************************************************************************/
/* Method: remove                                                             */
/* Purpose: removes a calendar from the list                                  */
/*                                                                            */
/* Parameters:                                                                */
/*  Calendar cal:    calendar to be removed from the list                     */
/* Returns: void                                                              */
/******************************************************************************/    

    public void remove (Calendar cal){
<span class="nc" id="L188">	calendarSet.remove(cal);</span>
<span class="nc" id="L189">}</span>
    
/******************************************************************************/
/* Method: removeAll                                                          */
/* Purpose: removes all calendars from the tree                               */
/*                                                                            */
/* Parameters:                                                                */
/*  void                                                                      */
/* Returns: void                                                              */
/******************************************************************************/ 

public void removeAll(){
<span class="nc" id="L201">	calendarSet.clear();</span>
<span class="nc" id="L202">}</span>
    
/******************************************************************************/
/* Method: search                                                             */
/* Purpose: search in the list for a particular appointment or type of        */
/* appointment and print all matches                                          */
/* Parameters:                                                                */
/* int: option    Decides the type of search (name, time, description...)     */
/* String: value  Item that will be looked for in the search method           */
/* Returns: int   Number of matches                                           */
/******************************************************************************/
//List of what the user can choose to look for in the calendar    
public static final int EVERYTHING = 1, CALENDAR = 2, TIME = 3, DESCRIPTION = 4;
/*
EVERYTHING :    user wants to print all the calendars
CALENDAR:       user wants to print a specific calendar
TIME:           user wants to look for a particular time in the appointments
DESCRIPTION:    user wants to look for a description among the appointments
*/

    public void search (int theOption, String lookedFor){
<span class="nc" id="L223">        int count = 0; </span>
<span class="nc bnc" id="L224" title="All 5 branches missed.">        switch (theOption){</span>
            case EVERYTHING:{
            /* The user wants to print all calendars. Loop through the database 
            and print everything.  */
<span class="nc" id="L228">            calendarSet.print();</span>
            //calendarSet.collectPrint(thisGUI);
<span class="nc" id="L230">            }break;</span>
            
            case CALENDAR:{
            /* The user wants to print only one calendar. Look for it */   
            try{
<span class="nc" id="L235">                count += calendarSet.search(lookedFor).getDatum().</span>
<span class="nc" id="L236">                        printCalendar();</span>
<span class="nc" id="L237">                        thisGUI.bufferToGui(MessageBoardOptions.RESULTS.getOption());</span>
<span class="nc" id="L238">            }   catch(NoSuchElementException exc){</span>
<span class="nc" id="L239">                    thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;The requested calendar does &quot;</span>
                            + &quot;not exist&quot;);
<span class="nc" id="L241">                    thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
<span class="nc" id="L242">                    break;</span>
            }            
<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (count == 0){</span>
<span class="nc" id="L245">                    thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;The requested calendar is &quot;</span>
                            + &quot;empty.&quot;);
<span class="nc" id="L247">                    thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
                }
<span class="nc" id="L249">            }break;</span>
            
            case TIME:{
            /* The user wants to look for a specific time. Loop through the 
            agenda and look for lesser start times with greater end times */
            try{
            //Create substrings representing date and time
<span class="nc" id="L256">            String subDate = lookedFor.substring(0, 8);</span>
            //part of the string that represents the date
<span class="nc" id="L258">            String subTime = lookedFor.substring(8, 12);</span>
            //part of the string that represents the time
<span class="nc" id="L260">            int subTimeInt = Integer.parseInt(subTime);</span>
            //parseInt the string that represents the time
            //it will be used by the lookForTime method
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if (traverseTime(subDate, subTimeInt) == false){</span>
<span class="nc" id="L264">                thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;The requested time is not included &quot;</span>
                        + &quot;in any of the appointments.&quot;);
<span class="nc" id="L266">                thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
            }
            //traverseTime(subDate, subTimeInt);
<span class="nc" id="L269">            }catch(StringIndexOutOfBoundsException exc){</span>
<span class="nc" id="L270">                thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;The requested time is not included &quot;</span>
                        + &quot;in any of the appointments.&quot;);
<span class="nc" id="L272">                thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
            }

<span class="nc" id="L275">            }break;</span>
            
            case DESCRIPTION:{
            /*  Look for descriptions among the appointments. Similar to the 
                case TIME. Here, an empty search means the entire list of 
                appointments, such as an empty search box. It could also show no
                results. It is NOT case sensitive. */
                                        
<span class="nc bnc" id="L283" title="All 2 branches missed.">            if (traverseDescription(lookedFor) == false){</span>
<span class="nc" id="L284">                thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;The requested descrption was not &quot;</span>
                        + &quot;found in any of the appointments.&quot;);
<span class="nc" id="L286">                thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
            }
            }break;            
        }
<span class="nc" id="L290">    }   </span>

/******************************************************************************/
/* Method: getCalendarSet                                                     */
/* Purpose: gets feature                                                      */
/*                                                                            */
/* Parameters:                                                                */
/* void                                                                       */
/* Returns: CalendarTree: the calendar tree                                   */
/******************************************************************************/    
    public CalendarTree getCalendarSet(){
<span class="nc" id="L301">        return calendarSet;</span>
    }
    
/******************************************************************************/
/* Method: traverseTime                                                       */
/* Purpose: traverses the tree and apply the method lookForTime in each of the*/
/*          nodes.                                                            */
/* Parameters:                                                                */
/* String subDate:          substring for date                                */
/* int    subTimeInt:       parsed substring for time                         */
/*  CalendarTreeNode current:  the tree's root (helper method only)           */     
/* Returns: boolean:    found value?                                          */
/******************************************************************************/        
    boolean traverseTime(String subDate, int subTimeInt){
<span class="nc" id="L315">        return traverseTime(calendarSet.getRoot(), subDate, subTimeInt);</span>
    } 
    boolean traverseTime(CalendarTreeNode current, String subDate, 
            int subTimeInt){
<span class="nc bnc" id="L319" title="All 2 branches missed.">        if (current == null) return false;</span>
        /* If left, middle and right functions return false, there is no element 
        to be found */
<span class="nc bnc" id="L322" title="All 2 branches missed.">	if(traverseTime(current.getLeft(), subDate, subTimeInt) == </span>
                false &amp;&amp;            
<span class="nc bnc" id="L324" title="All 2 branches missed.">	current.getDatum().lookForTime(subDate, subTimeInt) == 0 &amp;&amp;   </span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">	traverseTime(current.getRight(), subDate, subTimeInt) == false)</span>
<span class="nc" id="L326">            return false;</span>
        else{
<span class="nc" id="L328">            thisGUI.bufferToGui(MessageBoardOptions.RESULTS.getOption());</span>
<span class="nc" id="L329">            return true;</span>
        }
            
    }
       
/******************************************************************************/
/* Method: traverseDescription                                                */
/* Purpose: traverses the tree and apply the method lookForTime in each of the*/
/*          nodes.                                                            */
/* Parameters:                                                                */
/* String lookedFor:          substring for date                              */
/*  CalendarTreeNode current:  the tree's root (helper method only)           */    
/* Returns: boolean:    found value?                                          */
/******************************************************************************/        
    boolean traverseDescription(String lookedFor){
<span class="nc" id="L344">        return traverseDescription (calendarSet.getRoot(), lookedFor);</span>
    }
    boolean traverseDescription(CalendarTreeNode current, String lookedFor){
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (current == null) return false;</span>
        /* If left, middle and right functions return false, there is no element
        to be found */        
<span class="nc bnc" id="L350" title="All 2 branches missed.">	if(traverseDescription(current.getLeft(), lookedFor) == </span>
                false &amp;&amp;            
<span class="nc bnc" id="L352" title="All 2 branches missed.">	current.getDatum().printBasedOnDescription(lookedFor) == 0 &amp;&amp;   </span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">	traverseDescription(current.getRight(), lookedFor) == false)</span>
<span class="nc" id="L354">            return false;</span>
        else{
<span class="nc" id="L356">            thisGUI.bufferToGui(MessageBoardOptions.RESULTS.getOption());</span>
<span class="nc" id="L357">            return true;</span>
        }
    }
    
/******************************************************************************/
/* Method: wholeDatabase                                                      */
/* Purpose: Prints everything that is in the database. All the appointments   */
/*          of all the calendars.                                             */                                                                                      
/* Parameters:                                                                */   
/*  int      userChoseParsed   the user's option from the menu                */
/*  String   userLooksFor      a string containing the information looked for */
/*                             by the user. In this case, it is empty since   */
/*                             the user wants everything.                     */    
/* Returns: void                                                              */
/******************************************************************************/  
public void wholeDatabase(int userChoseParsed, String userLooksFor) {
<span class="nc" id="L373">    search(userChoseParsed, userLooksFor);</span>
<span class="nc" id="L374">}</span>

/******************************************************************************/
/* Method: printACalendar                                                     */
/* Purpose: Looks for a specific calendar in the database and prints it       */
/*                                                                            */                                                                                      
/* Parameters:                                                                */   
/*  int      userChoseParsed   the user's option from the menu                */
/*  String   keyboard          the requested calendar's name                  */

/* Returns: void                                                              */
/******************************************************************************/
public void printACalendar(int userChoseParsed, String keyboard){ 
<span class="nc" id="L387">    search(userChoseParsed, keyboard);</span>
<span class="nc" id="L388">}</span>

/******************************************************************************/
/* Method: lookForATime                                                       */
/* Purpose: Looks for a specific time in the database and prints all matches  */
/*                                                                            */                                                                                      
/* Parameters:                                                                */    
/*  int      userChoseParsed   the user's option from the menu                */
/*  String   chosenDate        the required date                              */
/*  String   chosenTime        the required time                              */
/* Returns: void                                                              */
/******************************************************************************/

void lookForATime(int userChoseParsed, 
            String chosenDate, String chosenTime){
    /*create an empty appointment just to check validity of date and time */
<span class="nc" id="L404">    Appointment checkVal = new Appointment();</span>
    //avoid getting the user turn it into an invalid string.
    
    try{   
<span class="nc bnc" id="L408" title="All 2 branches missed.">        while(! checkVal.isValid(Integer.parseInt(chosenDate))){</span>
        //it can still be longer or shorter than it should YYYYMMDD
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (chosenDate.length() != 8) </span>
<span class="nc" id="L411">            chosenDate = &quot;0&quot;;</span>
<span class="nc" id="L412">        Integer.parseInt(chosenDate); //try to force exc. catch</span>
        }
<span class="nc" id="L414">        } catch (NumberFormatException | StringIndexOutOfBoundsException exc){</span>
<span class="nc" id="L415">            chosenDate = &quot;0&quot;;</span>
        
    }
                    
        /* in order to check time validity, treat the user time as the start 
        time and choose 23:59 as the end time */
        //avoid getting the user turn it into an invalid string.
    
        try{  
<span class="nc bnc" id="L424" title="All 2 branches missed.">            while(! checkVal.isValid(Integer.parseInt(chosenTime), 2359)){</span>
            //it can still be longer or shorter than it should HHMM
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (chosenTime.length() != 4) </span>
<span class="nc" id="L427">                chosenTime = &quot;2460&quot;;</span>
<span class="nc" id="L428">            Integer.parseInt(chosenTime); //try to force exc catch</span>
        }
<span class="nc" id="L430">        }catch (NumberFormatException | StringIndexOutOfBoundsException exc){</span>
<span class="nc" id="L431">            chosenTime = &quot;2460&quot;;</span>
    }                    
<span class="nc" id="L433">    search(userChoseParsed, chosenDate + chosenTime);</span>
<span class="nc" id="L434">}</span>

/******************************************************************************/
/* Method: lookForADescription                                                */
/* Purpose: Looks for a specific description in the database and prints all   */
/*          matches                                                           */                                                                                      
/* Parameters:                                                                */    
/*  int      userChoseParsed   the user's option from the menu                */
/*  String   keyboard          the description looked for                     */
/* Returns: void                                                              */
/******************************************************************************/

void lookForADescription(int userChoseParsed, String keyboard){
<span class="nc" id="L447">    search(userChoseParsed, keyboard);</span>
<span class="nc" id="L448">}</span>

/******************************************************************************/
/* Method: addNewAppointment                                                  */
/* Purpose: Creates a whole new appointment and adds it to an existing        */
/*          calendar in the database                                          */                                                                                      
/* Parameters:                                                                */   
/*  String chosenCalendar      the calendar looked for                        */
/*  String chosenDate          the date looked for                            */
/*  String chosenSTime         the start time looked for                      */
/*  String chosenETime         the end time looked for                        */
/*  String chosenDescription   the description looked for                     */
/* Returns: void                                                              */
/******************************************************************************/
void addNewAppointment(String chosenCalendar,
        String chosenDate, String chosenSTime, String chosenETime,
        String chosenDescription){                                                                          
    //look for the specified calendar.
<span class="nc" id="L466">    Calendar chosenCal = new Calendar();</span>
<span class="nc" id="L467">    chosenCal.setCalendarName(chosenCalendar);</span>
  
<span class="nc bnc" id="L469" title="All 2 branches missed.">    if (getCalendarSet().search(chosenCal) == false){</span>
<span class="nc" id="L470">        thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;&gt;&gt;&gt; Calendar '&quot; + chosenCalendar</span>
<span class="nc" id="L471">                          + &quot;' not found in the list.&quot;);</span>
<span class="nc" id="L472">        thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
<span class="nc" id="L473">    }</span>
    else{
<span class="nc" id="L475">        chosenCal = getCalendarSet().search(chosenCalendar).getDatum();</span>
<span class="nc" id="L476">        if(addToCalendar(chosenCal, chosenDate, chosenSTime, chosenETime,</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">           chosenDescription)){</span>
<span class="nc" id="L478">        thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(),  &quot;**** Appointment included.&quot;);</span>
<span class="nc" id="L479">        thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
        }                        
    }                   
<span class="nc" id="L482">}</span>

/******************************************************************************/
/* Method: delAppointment                                                     */
/* Purpose: Deletes an appointment instance that currently exists in the      */
/*          database                                                          */                                                                                      
/* Parameters:                                                                */    
/*  String chosenCalendar      the calendar looked for                        */
/*  String chosenDate          the date looked for                            */
/*  String chosenSTime         the start time looked for                      */
/*  String chosenETime         the end time looked for                        */
/*  String chosenDescription   the description looked for                     */
/* Returns: void                                                              */
/******************************************************************************/

void delAppointment(String chosenCalendar,
        String chosenDate, String chosenSTime, String chosenETime,
        String chosenDescription){
<span class="nc" id="L500">    Calendar chosenCal = null;  //node referring to the cal                    </span>
    //look for the specified calendar.
    try{
<span class="nc" id="L503">        chosenCal = getCalendarSet().search(chosenCalendar).getDatum();</span>
<span class="nc" id="L504">    }catch(NoSuchElementException exc){</span>
<span class="nc" id="L505">        thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;&gt;&gt;&gt; Calendar '&quot; + chosenCalendar</span>
<span class="nc" id="L506">                          + &quot;' not found in the list.&quot;);</span>
<span class="nc" id="L507">        thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
<span class="nc" id="L508">        return;</span>
    }
<span class="nc" id="L510">    chosenCal.printCalendar();</span>
    try{
<span class="nc" id="L512">        if(deleteFromCalendar(chosenCal, chosenDate, chosenSTime,</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">           chosenETime, chosenDescription))</span>
<span class="nc" id="L514">            JOptionPane.showMessageDialog(null, &quot;**** Appointment excluded.&quot;);</span>
<span class="nc" id="L515">        else    System.out.println( &quot;**** Appointment not excluded.&quot;); </span>
<span class="nc" id="L516">    }catch(IndexOutOfBoundsException exc){</span>
<span class="nc" id="L517">        JOptionPane.showMessageDialog(null, &quot;Illegal parameters. No &quot;</span>
                + &quot;appointments were excluded&quot;);
    }                                               
<span class="nc" id="L520">}</span>

/******************************************************************************/
/* Method: addNewCalendar                                                     */
/* Purpose: Creates a whole new calendar to the program based on an existing  */
/*          text file.                                                        */                                                                                      
/* Parameters:                                                                */
/*  String userLooksFor        the name of a calendar file to be added        */
/* Returns: void                                                              */
/******************************************************************************/

void addNewCalendar(String userLooksFor){
<span class="nc bnc" id="L532" title="All 2 branches missed.">    if(loadFile(userLooksFor) == true){</span>
<span class="nc" id="L533">       JOptionPane.showMessageDialog(null, &quot;**** File added.&quot;);</span>
    }   
<span class="nc" id="L535">}</span>

/******************************************************************************/
/* Method: loadFile                                                           */
/* Purpose: stores a file's contents in the agenda by creating all the stored */
/*          appointments                                                      */
/* Parameters:                                                                */
/*  String fileName:      the name of the file to be added                    */
/* Returns: boolean:      add successfull?                                    */
/******************************************************************************/    
    
boolean loadFile(String fileName){
<span class="nc" id="L547">    Scanner currentFile = null;     //will contain one file at a time</span>
    try { 
<span class="nc" id="L549">        currentFile = new Scanner(new File(fileName));</span>
<span class="nc" id="L550">    }</span>
<span class="nc" id="L551">    catch (ArrayIndexOutOfBoundsException exc) {</span>
<span class="nc" id="L552">        JOptionPane.showMessageDialog(null, &quot;No arguments given to program.&quot;);</span>
<span class="nc" id="L553">        return (false);</span>
    } 
<span class="nc" id="L555">    catch (FileNotFoundException exc) { </span>
<span class="nc" id="L556">        JOptionPane.showMessageDialog(null, &quot;File ''&quot; + fileName + &quot;'' &quot;</span>
<span class="nc" id="L557">                + &quot;could not be opened at&quot;);</span>
<span class="nc" id="L558">        JOptionPane.showMessageDialog(null, System.getProperty(&quot;user.dir&quot;));</span>
<span class="nc" id="L559">        return (false); </span>
    } 

<span class="nc bnc" id="L562" title="All 2 branches missed.">    if (currentFile.hasNext()){  //if there is data            </span>
<span class="nc" id="L563">        String calendarName = currentFile.nextLine(); //get cal name</span>
        /*Check if the file already exists in the database*/           
<span class="nc" id="L565">        Calendar chosenCal = new Calendar();</span>
<span class="nc" id="L566">        chosenCal.setCalendarName(calendarName);</span>

<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (getCalendarSet().search(chosenCal) == true){</span>
<span class="nc" id="L569">            JOptionPane.showMessageDialog(null, &quot;**** File has already been &quot;</span>
                    + &quot;loaded into the program.&quot;);
<span class="nc" id="L571">            return(false);</span>
        }             

        //Create a calendar to store what is inside
<span class="nc" id="L575">        Calendar newCal = new Calendar(); //create instance of calendar</span>
<span class="nc" id="L576">        newCal.setCalendarName(calendarName);</span>
<span class="nc" id="L577">        newCal.setfileName(fileName);</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">        while (currentFile.hasNext()){  //keep filling up the calendar</span>
        /*Create a variable to keep track of illegal data that might appear. The 
        defective chunks of information will not be added to the agenda. */
<span class="nc" id="L581">            String inputStartTime = null, inputEndTime = null;  //temp</span>
            //input strings
<span class="nc" id="L583">            String inputDay = null; //temp input string </span>
<span class="nc" id="L584">            String description = null; //temp input string</span>
<span class="nc" id="L585">            inputDay = currentFile.nextLine(); //get the next line</span>
<span class="nc" id="L586">            Scanner pieces = new Scanner (inputDay); //break into pieces</span>
<span class="nc" id="L587">            pieces.useDelimiter(&quot;/&quot;);</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">            while (pieces.hasNext()){</span>
<span class="nc" id="L589">                inputDay = pieces.next();</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                if(pieces.hasNext())inputStartTime = pieces.next(); </span>
                //get start time
<span class="nc bnc" id="L592" title="All 2 branches missed.">                if(pieces.hasNext())inputEndTime = pieces.next(); </span>
                //get end time
<span class="nc bnc" id="L594" title="All 2 branches missed.">                if(pieces.hasNext())description = pieces.next();</span>
<span class="nc" id="L595">                addToCalendar(newCal, inputDay, inputStartTime,</span>
<span class="nc" id="L596">                        inputEndTime, description);</span>
            }
        }
<span class="nc" id="L599">        add(newCal); //add the calendar that was just created</span>
    }    
<span class="nc" id="L601">currentFile.close();</span>
<span class="nc" id="L602">return true;</span>
}

/******************************************************************************/
/* Method: delCalendar                                                        */
/* Purpose: Deletes a calendar from the lsit                                  */
/*                                                                            */                                                                                      
/* Parameters:                                                                */
/*  String chosenCalendar      the calendar to be deleted                     */        
/* Returns: void                                                              */
/******************************************************************************/
void delCalendar(String chosenCalendar){
    //Create string to store user input
<span class="nc" id="L615">    Calendar chosenCal = null;  //node referring to the cal                     </span>
    //look for the specified calendar.
    try{
<span class="nc" id="L618">        chosenCal = getCalendarSet().search(chosenCalendar).getDatum();</span>
<span class="nc" id="L619">    }catch(NoSuchElementException exc){</span>
<span class="nc" id="L620">        JOptionPane.showMessageDialog(null, &quot;&gt;&gt;&gt; Calendar '&quot; + chosenCalendar</span>
<span class="nc" id="L621">                          + &quot;' not found in the list.&quot;);</span>
<span class="nc" id="L622">        return;</span>
    }
<span class="nc" id="L624">    thisGUI.printToGui(MessageBoardOptions.MESSAGE.getOption(), &quot;&gt;&gt;&gt; Chosen calendar: &quot; + chosenCal.</span>
<span class="nc" id="L625">                getCalendarName()+ &quot;\n\&quot;&quot;);</span>
<span class="nc" id="L626">    thisGUI.bufferToGui(MessageBoardOptions.MESSAGE.getOption());</span>
    //create string to store user choice
<span class="nc" id="L628">    String answer = &quot;&quot;;</span>
<span class="nc bnc" id="L629" title="All 4 branches missed.">    while(answer.compareTo(&quot;Y&quot;) != 0 &amp;&amp; answer.compareTo(&quot;N&quot;) != 0</span>
<span class="nc bnc" id="L630" title="All 4 branches missed.">          &amp;&amp; answer.compareTo(&quot;y&quot;) != 0  &amp;&amp; answer.compareTo(&quot;n&quot;) != 0){</span>
<span class="nc" id="L631">            answer = JOptionPane.showInputDialog(&quot;Are you sure you want to &quot;</span>
                    + &quot;delete&quot; + &quot; the calendar above? Y = yes, N = no&quot;);
    }
<span class="nc bnc" id="L634" title="All 2 branches missed.">    if(answer.toLowerCase().compareTo(&quot;n&quot;) == 0){</span>
<span class="nc" id="L635">        JOptionPane.showMessageDialog(null,&quot;&gt;&gt;&gt; Calendar not deleted&quot;);</span>
<span class="nc" id="L636">    }</span>
    else{
<span class="nc" id="L638">        remove(chosenCal);</span>
<span class="nc" id="L639">        JOptionPane.showMessageDialog(null,&quot;&gt;&gt;&gt; Calendar deleted&quot;);</span>
    }          
<span class="nc" id="L641">}</span>

/******************************************************************************/
/* Method: writeToDisk                                                        */
/* Purpose: saves all content from the calendars and stores them in the       */
/*          original files in the disk                                        */
/* Parameters:                                                                */
/*  CalendarTreeNode current:  the tree's root (helper method only)           */
/* Returns: void                                                              */
/******************************************************************************/
    public void writeToDisk(){
        //Check if user really wants to save to the database
<span class="nc" id="L653">        String answer = &quot;&quot;;</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">        while(answer.toLowerCase().compareTo(&quot;y&quot;) != 0 &amp;&amp; </span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        answer.toLowerCase().compareTo(&quot;n&quot;) != 0 ){</span>
<span class="nc" id="L656">            answer = JOptionPane.showInputDialog(&quot;Are you sure you want to save&quot;</span>
                    + &quot; all contents to the database? Y = yes, N = no&quot;);
        }
<span class="nc bnc" id="L659" title="All 2 branches missed.">        if(answer.toLowerCase().compareTo(&quot;y&quot;) == 0)</span>
<span class="nc" id="L660">            writeToDisk(calendarSet.getRoot());</span>
        else
<span class="nc" id="L662">            JOptionPane.showMessageDialog(null,&quot;Database not modified.&quot;);</span>
<span class="nc" id="L663">    }</span>
    // Traverse the calendar tree, read from every calendar. Open the files
    private void writeToDisk(CalendarTreeNode current){
<span class="nc bnc" id="L666" title="All 2 branches missed.">        if (current == null) return;        </span>
<span class="nc" id="L667">        writeToDisk(current.getLeft());</span>
<span class="nc" id="L668">        writeToDisk(current.getRight());</span>
    // Sends the calendar and the filename to perform the writing
<span class="nc bnc" id="L670" title="All 2 branches missed.">        if(writeToDisk(current.getDatum()))</span>
<span class="nc" id="L671">            JOptionPane.showMessageDialog(null,&quot;Calendar file ''&quot; + </span>
<span class="nc" id="L672">                    current.getDatum().</span>
<span class="nc" id="L673">            getfileName() + &quot;'' was successfully written.&quot;);</span>
<span class="nc" id="L674">    }        </span>

/******************************************************************************/
/* Method: writeToDisk (with calendar only)                                   */
/* Purpose: saves all content from the calendars and stores them in the       */
/*          original files in the disk                                        */
/* Parameters:                                                                */
/*  Calendar currentCal   the calendar that will provide content to the file  */    
/* Returns: boolean:      write successful?                                   */
/******************************************************************************/
    private boolean writeToDisk(Calendar currentCal){
        try {
            // Open file that will receive the calendar contents
<span class="nc" id="L687">            File file = new File(currentCal.getfileName()); // current file</span>
            // If file doesn't exist, create it.
<span class="nc bnc" id="L689" title="All 2 branches missed.">            if (!file.exists()) {</span>
<span class="nc" id="L690">                file.createNewFile();</span>
            }
            // File writer element
<span class="nc" id="L693">            FileWriter fWritter = new FileWriter(file.getAbsoluteFile());</span>
            // Buffered writer element
<span class="nc" id="L695">            BufferedWriter bWritter = new BufferedWriter(fWritter);</span>
<span class="nc" id="L696">            String currentLine = &quot;&quot;; // will contain data from the calendars</span>
            // Print calendar title
<span class="nc" id="L698">            bWritter.write(currentCal.getCalendarName());</span>
<span class="nc" id="L699">            bWritter.newLine(); // move to the next line</span>
            // Form lines with the calendar contents. Do this for all the 
            // appointments
<span class="nc" id="L702">            AppointmentNode auxApp = currentCal.getHead(); //index to the list</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">            while (auxApp != null){     // look at the whole list</span>
<span class="nc" id="L704">                currentLine = auxApp.getDatum().getDate() + &quot;/&quot; +</span>
<span class="nc" id="L705">                auxApp.getDatum().getStartTime() + &quot;/&quot; +</span>
<span class="nc" id="L706">                auxApp.getDatum().getEndTime() + &quot;/&quot; +</span>
<span class="nc" id="L707">                auxApp.getDatum().getDescription();</span>
                
<span class="nc" id="L709">                bWritter.write(currentLine); //write formed line</span>
<span class="nc" id="L710">                bWritter.newLine(); //move to the next line</span>
                
<span class="nc" id="L712">                auxApp = auxApp.getNext();  //move on to the next element</span>
            }   
<span class="nc" id="L714">            bWritter.close();   //close the buffer to flush it to disk.</span>
<span class="nc" id="L715">        } catch (IOException exc) {</span>
            //System.out.println(&quot;There was a mistake with input data.&quot;);
<span class="nc" id="L717">            return false;</span>
        }
<span class="nc" id="L719">        return true;</span>
     }

/******************************************************************************/
/* Method: readFromDisk                                                       */
/* Purpose: restores the database by reloading all the files from all         */
/*          calendars and saving contents to the data structures              */
/* Parameters:                                                                */
/*  CalendarTreeNode current:  the tree's root (helper method only)           */   
/* Returns: void                                                              */
/******************************************************************************/   
    public void readFromDisk(){
        //Check if user really wants to reload the database
<span class="nc" id="L732">        String answer = &quot;&quot;;</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">        while(answer.toLowerCase().compareTo(&quot;y&quot;) != 0 &amp;&amp; </span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        answer.toLowerCase().compareTo(&quot;n&quot;) != 0 ){</span>
<span class="nc" id="L735">            answer = JOptionPane.showInputDialog(&quot;Are you sure you want to &quot;</span>
                    + &quot;reload the database? Y = yes, N = no&quot;);
        }
<span class="nc bnc" id="L738" title="All 2 branches missed.">        if(answer.toLowerCase().compareTo(&quot;y&quot;) == 0)</span>
<span class="nc" id="L739">            readFromDisk(calendarSet.getRoot());</span>
        else
<span class="nc" id="L741">            JOptionPane.showMessageDialog(null,&quot;Database not reloaded.&quot;);</span>
<span class="nc" id="L742">    }</span>
    // Traverse the calendar tree, delete every calendar. Add them again.
    private void readFromDisk(CalendarTreeNode current){
<span class="nc bnc" id="L745" title="All 2 branches missed.">        if (current == null) return;</span>
        // Since the traversal alters the tree, use LRN. Nodes altered lastly.        
<span class="nc" id="L747">        readFromDisk(current.getLeft());</span>
<span class="nc" id="L748">        readFromDisk(current.getRight());</span>
        // Get file name in order to be able to find it again and reload it.
<span class="nc" id="L750">        String toBeReloaded = current.getDatum().getfileName(); //file name</span>
<span class="nc" id="L751">        remove(current.getDatum()); //remove calendar</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">        if(loadFile(toBeReloaded)){ //load it again. Check for success</span>
<span class="nc" id="L753">            JOptionPane.showMessageDialog(null,&quot;Calendar ''&quot; +</span>
<span class="nc" id="L754">                    current.getDatum().</span>
<span class="nc" id="L755">            getCalendarName() + &quot;'' reloaded.&quot;);</span>
        }    
<span class="nc" id="L757">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>